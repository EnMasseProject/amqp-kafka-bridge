{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "http://example.com/product.schema.json",
  "title": "RateLimiting",
  "description": "Rate limiting rules",
  "type": "array",
  "minItems": 1,
  "items": {
    "type": "object",
    "additionalProperties": false,
    "required": [
      "limits"
    ],
    "properties": {
      "topic": {
        "type": "string",
        "minLength": 2
      },
      "strategy": {
        "type": "string",
        "enum": [
          "global",
          "local"
        ],
        "default": "local"
      },
      "limits": {
        "type": "array",
        "minItems": 1,
        "items": {
          "type": "object",
          "additionalProperties": false,
          "anyOf": [
            {
              "required": [
                "seconds"
              ]
            },
            {
              "required": [
                "minutes"
              ]
            },
            {
              "required": [
                "hours"
              ]
            }
          ],
          "dependencies": {
            "header-value": [
              "header-name"
            ],
            "header-name": [
              "header-value"
            ]
          },
          "properties": {
            "seconds": {
              "type": "integer",
              "minimum": 1,
              "description": "Max number of allowed requests in a second."
            },
            "minutes": {
              "type": "integer",
              "minimum": 1,
              "description": "Max number of allowed requests in a minute"
            },
            "hours": {
              "type": "integer",
              "minimum": 1,
              "description": "Max number of allowed requests in an hour"
            },
            "header-name": {
              "type": "string",
              "minLength": 2,
              "description": "header name, that is used to differentiate between different type of users (e.g. premium, free tier, etc.). If present, the header-value must be set too"
            },
            "header-value": {
              "type": "string",
              "minLength": 2,
              "description": "regex to match to the actual header value. If this parameter is missing it is enough for the header-name to be present. If present, header-name must be set too"
            },
            "group-by-header": {
              "type": "string",
              "minLength": 2,
              "description": "The value of this header will be used in order to aggregate clients. By default is ignored (only IP address is considered)"
            }
          }
        }
      }
    }
  }
}
